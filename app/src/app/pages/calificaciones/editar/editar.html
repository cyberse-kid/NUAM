<div class="editar-container">
  
  <!-- Header con breadcrumb -->
  <div class="page-header">
    <div class="breadcrumb">
      <span (click)="volver()" class="breadcrumb-link">Dashboard</span>
      <span class="separator">‚Ä∫</span>
      <span (click)="cancelar()" class="breadcrumb-link">Calificaciones</span>
      <span class="separator">‚Ä∫</span>
      <span class="breadcrumb-current">Editar #{{ id }}</span>
    </div>
    <h1 class="page-title">‚úèÔ∏è Editar Calificaci√≥n</h1>
    <p class="page-subtitle">Modifica los datos de la calificaci√≥n tributaria</p>
  </div>

  <!-- Loading inicial -->
  <div *ngIf="loading" class="loading-card">
    <div class="spinner"></div>
    <p>Cargando calificaci√≥n...</p>
  </div>

  <!-- Error 404 -->
  <div *ngIf="notFound && !loading" class="error-card">
    <div class="error-icon">‚ùå</div>
    <h2>Calificaci√≥n no encontrada</h2>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="cancelar()">
      Volver al listado
    </button>
  </div>

  <!-- Formulario -->
  <div *ngIf="!loading && !notFound" class="form-card">
    
    <!-- Mensajes -->
    <div class="alert alert-error" *ngIf="error">
      ‚ö†Ô∏è {{ error }}
    </div>

    <div class="alert alert-success" *ngIf="successMessage">
      {{ successMessage }}
    </div>

    <form (ngSubmit)="guardar()" #calificacionForm="ngForm">

      <!-- Secci√≥n: Informaci√≥n B√°sica -->
      <div class="form-section">
        <h3 class="section-title">üìã Informaci√≥n B√°sica</h3>

        <!-- Campo Instrumento -->
        <div class="form-group">
          <label for="instrumento" class="form-label">
            Instrumento <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="instrumento"
            class="form-input"
            [(ngModel)]="form.instrumento" 
            name="instrumento" 
            placeholder="Ej: DJ1948-2024-001"
            required
            [disabled]="loadingSubmit">
          <small class="form-hint">C√≥digo o identificador del instrumento tributario</small>
        </div>

        <!-- Campo Tipo de Calificaci√≥n -->
        <div class="form-group">
          <label for="tipo_calificacion" class="form-label">
            Tipo de Calificaci√≥n <span class="required">*</span>
          </label>
          <select 
            id="tipo_calificacion"
            class="form-input"
            [(ngModel)]="form.tipo_calificacion" 
            name="tipo_calificacion"
            required
            [disabled]="loadingSubmit">
            <option value="">Seleccione un tipo...</option>
            <option *ngFor="let tipo of tiposCalificacion" [value]="tipo.value">
              {{ tipo.label }}
            </option>
          </select>
          <small class="form-hint">Tipo de calificaci√≥n tributaria</small>
        </div>

        <!-- Campo Estado -->
        <div class="form-group">
          <label for="estado" class="form-label">
            Estado
          </label>
          <select 
            id="estado"
            class="form-input"
            [(ngModel)]="form.estado" 
            name="estado"
            [disabled]="loadingSubmit">
            <option *ngFor="let estado of estadosDisponibles" [value]="estado.value">
              {{ estado.label }}
            </option>
          </select>
          <small class="form-hint">Estado actual de la calificaci√≥n</small>
        </div>
      </div>

      <!-- Secci√≥n: Valores y C√°lculos -->
      <div class="form-section">
        <h3 class="section-title">üí∞ Valores y C√°lculos</h3>

        <!-- Campo Monto Original -->
        <div class="form-group">
          <label for="monto_original" class="form-label">
            Monto Original
          </label>
          <div class="input-with-icon">
            <span class="input-icon">$</span>
            <input 
              type="number" 
              id="monto_original"
              class="form-input with-icon"
              [(ngModel)]="form.monto_original" 
              name="monto_original"
              placeholder="0.00"
              [disabled]="loadingSubmit">
          </div>
          <small class="form-hint">Monto original asociado a la calificaci√≥n</small>
        </div>

        <!-- Campo Factor Calculado -->
        <div class="form-group">
          <label for="factor_calculado" class="form-label">
            Factor Calculado
          </label>
          <input 
            type="number" 
            id="factor_calculado"
            class="form-input"
            step="0.0001" 
            [(ngModel)]="form.factor_calculado" 
            name="factor_calculado"
            placeholder="0.0000"
            [disabled]="loadingSubmit">
          <small class="form-hint">Factor de c√°lculo tributario con 4 decimales</small>
        </div>
      </div>

      <!-- Secci√≥n: Informaci√≥n Adicional -->
      <div class="form-section">
        <h3 class="section-title">üìù Informaci√≥n Adicional</h3>

        <!-- Campo Usuario Responsable -->
        <div class="form-group">
          <label for="usuario_responsable" class="form-label">
            Usuario Responsable <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="usuario_responsable"
            class="form-input"
            [(ngModel)]="form.usuario_responsable" 
            name="usuario_responsable"
            placeholder="Ej: Nicol√°s"
            required
            [disabled]="loadingSubmit">
          <small class="form-hint">Nombre del usuario responsable de la calificaci√≥n</small>
        </div>

        <!-- Campo Observaciones -->
        <div class="form-group">
          <label for="observaciones" class="form-label">
            Observaciones
          </label>
          <textarea 
            id="observaciones"
            class="form-input form-textarea"
            [(ngModel)]="form.observaciones" 
            name="observaciones"
            rows="4"
            placeholder="Ingrese observaciones adicionales..."
            [disabled]="loadingSubmit"></textarea>
          <small class="form-hint">Comentarios o notas adicionales sobre la calificaci√≥n</small>
        </div>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="eliminar()"
          [disabled]="loadingSubmit">
          üóëÔ∏è Eliminar
        </button>
        
        <div class="actions-right">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="cancelar()"
            [disabled]="loadingSubmit">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="loadingSubmit || !calificacionForm.valid">
            <span *ngIf="!loadingSubmit">üíæ Guardar Cambios</span>
            <span *ngIf="loadingSubmit">‚è≥ Guardando...</span>
          </button>
        </div>
      </div>

    </form>
  </div>

  <!-- Card de informaci√≥n -->
  <div *ngIf="!loading && !notFound" class="info-card">
    <h3>‚ÑπÔ∏è Informaci√≥n</h3>
    <ul>
      <li><strong>ID:</strong> {{ id }}</li>
      <li>Los campos marcados con <span class="required">*</span> son obligatorios</li>
      <li>Los cambios se guardar√°n al hacer clic en "Guardar Cambios"</li>
      <li>Puedes eliminar esta calificaci√≥n usando el bot√≥n "Eliminar"</li>
    </ul>
  </div>

</div>